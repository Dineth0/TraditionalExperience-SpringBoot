<!DOCTYPE html>
<html lang="en">
    <meta charset="UTF-8">
    <title>Instructors</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body{
            background: url(assets/newitmpettern.png) repeat;
            background-size: cover;
            color: #3a2a1a;
        }
        header {
            background: rgba(76, 46, 31, 0.9);
            padding: 1rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid #a9743f;
        }

        header h1 {
            font-size: 2rem;
            color: #f1cc7f;
        }

        nav a {
            color: #f1cc7f;
            margin: 0 1rem;
            text-decoration: none;
            font-weight: bold;
            transition: color 0.3s ease;
        }

        nav a:hover {
            color: #ffcc00;
        }


        .section-title{
            text-align: center;
            margin: 40px 0 30px;
            font-size: 36px;
            font-weight: bold;
            color: #e29341;
        }

        .card-custom {
            background-color: #b5925a;
            border: none;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 8px 20px rgba(0,0,0,0.4);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .card-custom:hover {
            transform: translateY(-8px);
            box-shadow: 0 12px 28px rgba(0,0,0,0.6);
        }


        .card-custom img {
            height: 320px;
            width: 100%;
            object-fit: cover;
        }

        .card-body h5 {
            font-size: 20px;
            font-weight: bold;
            width: 250px;
            color: #3a1f1f;
        }

        .card-body p {
            font-size: 14px;
            color: #4a3a2a;
        }
        #logout{
            background: #946a28;
            border: none;
            color: #fff;
            padding: 10px 25px;
            border-radius: 50px;
            font-weight: 600;
            transition: 0.3s;
        }




    </style>
</head>
<body>
<header class="sticky-top" style="background: rgba(69,41,31,0.9); border-bottom: 1px solid #a9743f;">
    <nav class="navbar navbar-expand-lg navbar-dark container-fluid">
        <a class="navbar-brand" href="#" style="color: #e2c6a3;">Heritage Portal</a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse justify-content-end" id="navbarNav">
            <ul class="navbar-nav">
                <li class="nav-item"><a class="nav-link" href="home.html">Home</a></li>
                <li class="nav-item"><a class="nav-link" href="items.html">Items</a></li>
                <li class="nav-item"><a class="nav-link" href="AllWorkshopList.html">Workshops</a></li>
                <button id="logout">Logout</button>
            </ul>
        </div>
    </nav>
</header>

<div class="container">
    <h2 class="section-title">Our Instructors</h2>
    <div class="row g-4 justify-content-center" id="instructorCards">

    </div>
    <nav aria-label="Page navigation">
        <ul class="pagination justify-content-center" id="ItemPagination">
            <li class="page-item">
                <a class="page-link" href="#" id="prevPage">Previous</a>
            </li>
            <li class="page-item active" aria-current="page">
                <span class="page-link">1</span>
            </li>
            <li class="page-item"><a class="page-link" href="#">2</a></li>


            <li class="page-item">
                <a class="page-link" href="#" id="nextPage">Next</a>
            </li>
        </ul>
    </nav>
</div>

<script src="js/jquery-3.7.1.min.js"></script>
<script src="js/SignIn.js"></script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>


<script>
    $(document).ready(function(){
        let currentPage = 0;
        const pageSize = 3;
        let totalPages = 0;
        loadInstructorForCard();

        function loadInstructorForCard() {
            let token = localStorage.getItem("authtoken")
            $.ajax({
                url: `http://localhost:8080/api/v1/instructor/paginated?page=${currentPage}&size=${pageSize}`,
                type: 'GET',
                headers: {
                    'Authorization': 'Bearer ' + token
                },
                success: function (res) {
                    let instructors = res || []
                    let cards = ""

                    instructors.forEach(instructor => {
                        let instructorName = instructor.instructorName;
                        let age = instructor.age;
                        let category = instructor.category;
                        let instructorEmail = instructor.instructorEmail;
                        let instructorPhone = instructor.instructorPhone;
                        let imagePath = instructor.image;

                        let imageUrl = imagePath
                            ? `http://localhost:8080/uploads/${imagePath}`
                            : null

                        let imagesHtml = imageUrl
                            ? `<img src="${imageUrl}" alt="image" width="40" style="margin-right: 5px;">:`
                            : 'No Images Found';


                        cards += `
                        <div class="col-md-3 mb-3">
                            <div class="card card-custom h-100">
                                ${imageUrl ? `<img src="${imageUrl}" class="card-img-top" alt="${instructorName}">`
                            : null}

                                <div class="card-body">
                                    <h5 class="card-title">${instructorName}</h5>
                                    <p class="card-text"><strong>Age : </strong>${age}</p>
                                    <p class="card-text"><strong>Workshop Name : </strong>${category}</p>
                                    <p class="card-text"><strong>Email : </strong>${instructorEmail}</p>
                                    <p class="card-text"><strong>Phone : </strong>${instructorPhone}</p>
                                </div>
                            </div>
                        </div>
                   `;


                    })
                    $('#instructorCards').html(cards);
                    loadPaginationInstructor();
                },

                error: function(err){
                    console.log(err);
                    Swal.fire({
                        icon: "error",
                        title: "Can not Load Instructors, Login fist",
                        showConfirmButton: false,
                        timer: 2000
                    })
                }
            });
        }

        function loadPaginationInstructor() {
            let token = localStorage.getItem("authtoken")
            $.ajax({
                url: `http://localhost:8080/api/v1/instructor/total-pages?size=${pageSize}`,
                method: "GET",
                headers:{
                    'Authorization': 'Bearer ' + token
                },
                success: function (tp) {
                    totalPages = tp
                    let paginationHTML = "";
                    paginationHTML += `
                    <li class="page-item ${ currentPage === 0 ? 'disabled' : ''}">
                        <a class="page-link" href="#" id="prevPage" >Previous</a>
                    </li>
                `;

                    const windowSize = 3
                    let start = currentPage - 1;
                    let end = currentPage + 1

                    if(start < 0) { start = 0}
                    if(end >= totalPages) { end = totalPages - 1}

                    if(end - start + 1 < windowSize && totalPages >= windowSize) {
                        if(start === 0){
                            end = windowSize - 1;
                        }else if(end === totalPages - 1){
                            start = totalPages - windowSize;
                        }
                    }
                    for(let i = start; i <= end; i++) {
                        paginationHTML += `
               <li class="page-item ${i === currentPage ? 'active' : ''}">
                        <a class="page-link" href="#" onclick="goToPage(${i})">${i + 1}</a>
                    </li>
            `
                    }
                    paginationHTML += `
               <li class="page-item ${ currentPage === totalPages - 1 ? 'disabled' : ''}">
                        <a class="page-link" href="#" id="nextPage" >Next</a>
                    </li>
          `
                    $('.pagination').html(paginationHTML);
                },
                error: function (xhr) {
                    Swal.fire({
                        icon: "error",
                        title: "Can not Load Instructors, Login fist",
                        showConfirmButton: false,
                        timer: 2000
                    })
                }
            });
        }

        window.goToPage = function(page) {
            currentPage = page;
            loadInstructorForCard();
        }

        $(document).on('click', '#prevPage', function(e) {
            e.preventDefault();
            if (currentPage > 0) goToPage(currentPage - 1);
        });

        $(document).on('click', '#nextPage', function(e) {
            e.preventDefault();
            if (currentPage < totalPages - 1) goToPage(currentPage + 1);
        });
    })
</script>
</body>
</html>