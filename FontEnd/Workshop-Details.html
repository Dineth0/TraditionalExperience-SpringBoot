<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Workshop Details</title>

    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />

    <style>
        body {
            background: url(assets/itempattern.png) repeat;
            background-size: cover;
            font-family: 'Segoe UI', sans-serif;
        }

        /* ---------- Gallery ---------- */
        .gallery-thumbs {
            max-height: 450px;
        }
        .thumbLeft {
            position: relative;
            margin-bottom: 10px;
        }
        .gallery-thumbs img {
            width: 100%;
            height: 90px;
            border-radius: 12px;
            cursor: pointer;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        .gallery-thumbs img:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.25);
        }
        .see-moreBTN {
            position: absolute;
            inset: 0;
            background: rgba(0,0,0,0.5);
            color: #fff;
            display: flex;
            justify-content: center;
            align-items: center;
            font-weight: bold;
            font-size: 1.1rem;
            border-radius: 12px;
            cursor: pointer;
        }

        /* ---------- Main Image ---------- */
        .main-image img {
            width: 100%;
            height: 470px;
            object-fit: cover;
            border-radius: 14px;
            box-shadow: 0 6px 20px rgba(0,0,0,0.25);
        }

        /* ---------- Right Side Card ---------- */
        .details-card {
            background-color: #886230;
            border-radius: 16px;
            padding: 20px;
            margin-left: 30px;
            margin-bottom: 30px;
            box-shadow: 0 6px 18px rgba(0, 0, 0, 0.2);
            position: fixed;
        }

        #rightSide {

            top: 100px;
            right: 40px;
            width: 38%;
            z-index: 1000;
        }
        /* parent ‡∂ë‡∂ö‡∑ö height adjust ‡∂ö‡∂ª‡∂±‡∑ä‡∂± */



        /* ---------- Picker Box ---------- */
        .picker-box {
            border: 1px solid #e6e6e6;
            border-radius: 12px;
            background: #5f352a;
            overflow: hidden;

            transition: all 0.2s;
        }
        .picker-cell {
            padding: 14px;
            display: flex;
            align-items: center;
            gap: 10px;
            flex: 1;
            cursor: pointer;
            transition: background 0.2s;
        }
        .picker-cell:hover {
            background: #a45b48;
        }
        .picker-cell .label {
            font-size: 12px;
            color: #666;
            display: block;
        }
        .picker-cell .value {
            font-weight: 600;
        }

        /* ---------- Button ---------- */
        .btn-primary-viator {
            background: linear-gradient(90deg, #757225, #459166);
            border: none;
            color: white;
            font-weight: 600;
            padding: 14px;
            border-radius: 12px;
            font-size: 16px;
            transition: all 0.3s ease;
        }
        .btn-primary-viator:hover {
            background: linear-gradient(90deg, #27ae60, #2ecc71);
            transform: translateY(-2px);
            box-shadow: 0 6px 14px rgba(0,0,0,0.2);
        }

        /* ---------- Info Line ---------- */
        .info-line {
            color: #f5faf5;
            font-size: 14px;
            margin-bottom: 6px;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        .info-line i {
            color: #ebeeec;
        }

        /* ---------- Availability ---------- */
        .availability-list .slot {
            border: 1px solid #e7e7e7;
            border-radius: 12px;
            padding: 10px 14px;
            margin-bottom: 8px;
            background: #fff;
            font-weight: 500;
            transition: 0.2s;
        }
        .availability-list .slot:hover {
            border-color: #2ecc71;
            background: #f7fff9;
        }
        .availability-empty {
            padding: 12px;
            border-radius: 12px;
            background: #fff3cd;
            border: 1px solid #ffeeba;
            color: #8a6d3b;
        }

        /* ---------- Workshop Details Text ---------- */
        .row p {
            margin-bottom: 6px;
            font-size: 15px;
        }
        .row p strong {
            color: #f1e2c1;
        }
        .price {
            font-size: 18px;
            color: #f5c542;
            font-weight: bold;
        }
        .workshop-info {
            background: rgba(95,53,42,0.6);
            padding: 18px;
            border-radius: 14px;
            margin-top: 40px;
            margin-bottom: 30px;
            box-shadow: 0 6px 16px rgba(0,0,0,0.2);
        }
        .review-info {
            background: rgba(95,53,42,0.6);
            padding: 18px;
            border-radius: 14px;
            margin-top: 40px;
            margin-bottom: 30px;
            box-shadow: 0 6px 16px rgba(0,0,0,0.2);
        }
        .info-item {
            display: flex;
            align-items: center;
            margin-bottom: 12px;
            color: #f5f5f5;
            font-size: 15px;
        }
        .info-item i {
            width: 25px;
            font-size: 16px;
            margin-right: 10px;
            color: #f1c40f;
        }
        .info-item strong {
            color: #ffe9b1;
            margin-right: 4px;
        }
        #workshopDescription{
            font-size: 18px;
            color: #ffffff;
            margin-bottom: 20px;
        }
        #workshopIncludes{
            font-size: 18px;
            color: #ffffff;
        }
        #workshopName{
            margin-bottom: 20px;
            margin-left: 20px;
            color: #e5b53c;
        }
        #ReviewBtn{
            margin-right: 590px;
        }
        #MyBookingBtn{
            margin-right: 100px;
        }
        #logout{
            background: #946a28;
            border: none;
            color: #fff;
            padding: 10px 25px;
            border-radius: 50px;
            font-weight: 600;
            transition: 0.3s;
        }
        .star {
            font-size: 1.6rem;
            cursor: pointer;
        }
        .star.checked { color: #ffc107; }




    </style>
</head>

<body>
<header class="sticky-top" style="background: rgba(71,40,40,0.9); border-bottom: 1px solid #bf8f5f;">
    <nav class="navbar navbar-expand-lg navbar-dark container-fluid">
        <a class="navbar-brand" href="#" style="color: #e2c6a3;">Heritage Portal</a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse justify-content-end" id="navbarNav">
            <ul class="navbar-nav">
                <li class="nav-item"><a class="nav-link" href="home.html">Home</a></li>
                <li class="nav-item"><a class="nav-link" href="Instructors.html">Instructors</a></li>
                <li class="nav-item"><a class="nav-link" href="#">Workshops</a></li>
                <li class="nav-item"><a class="nav-link" href="#">Reviews</a></li>
                <button id="logout">Logout</button>
            </ul>
        </div>
    </nav>
</header>
<div class="d-flex justify-content-between align-items-center my-3">
    <h2 id="workshopName" ></h2>
    <button id="ReviewBtn" data-bs-toggle="modal" data-bs-target="#ReviewModal">
        <i class="fa-solid fa-star"></i> Reviews
    </button>


</div>
<div class="container my-3">
    <div class="row g-4">
        <div class="col-md-7">
            <div class="row">
                <div class="col-3 gallery-thumbs" id="thumbGallery"></div>
                <div class="col-9 main-image" id="mainImage">
                    <img src="" alt="">
                </div>
            </div>
            <div class="workshop-info ">
                <div class="info-item">
                    <i class="fa-solid fa-clock"></i>
                    <span><strong>Duration:</strong> <span id="workshopDuration"></span></span>
                </div>
                <div class="info-item">
                    <i class="fa-solid fa-language"></i>
                    <span><strong>Language:</strong> <span id="workshopLanguage"></span></span>
                </div>
                <div class="info-item">
                    <i class="fa-solid fa-map-marker-alt"></i>
                    <span><strong>Address:</strong> <span id="workshopAddress"></span></span>
                </div>
                <div class="info-item">
                    <i class="fa-solid fa-clock-rotate-left"></i>
                    <span><strong>Times:</strong> <span id="workshopTimes"></span></span>
                </div>

            </div>
            <div class="info-item">
                <i class="fa-solid fa-align-left"></i>
                <span><strong style="font-size: 30px">Overview:</strong> </span>
            </div>
            <p id="workshopDescription"></p>
            <div class="info-item">
                <i class="fa-solid fa-check-circle"></i>
                <span><strong style="font-size: 30px">Includes:</strong> </span>
            </div>
            <p id="workshopIncludes"></p>

        </div>
        <div class="review-info mt-4">
            <div class="info-item">
                <i class="fa-solid fa-star" style="color:#f1c40f; cursor:pointer;" id="review"></i>
                <span><strong style="font-size: 24px;">Reviews</strong></span>
            </div>
            <div id="reviewSummary" >
                <p><span id="reviewCount">0</span> Reviews ‚Ä¢ Average Rating: <span id="avgRating">0</span>/5 ‚≠ê</p>
            </div>
        </div>

        <div class="col-lg-5">
            <div id="rightSide" class="details-card">
                <p class="mb-2 fs-5">
                    From <span id="fees">0</span><span class="text-muted"> per person</span>
                </p>

                <!-- Date & Travelers IU like screenshot -->
                <div class="picker-box d-flex mt-2">
                    <!-- Date cell -->
                    <div class="picker-cell flex-fill" id="dateCell">
                        <div class="w-100">
                            <span class="label">Date</span>
                            <span class="value" id="dateDisplay">Pick a date</span>
                            <input type="date" class="form-control d-none" id="bookingDate">
                        </div>

                    </div>

                    <!-- Travelers cell -->
                    <div class="picker-cell flex-fill" id="participantCell">
                        <div class="w-100">
                            <span class="label">Participants </span>
                            <span class="value" id="participantCountDisplay"></span>
                        </div>
                        <i class="fa-solid fa-angle-down ms-auto"></i>
                    </div>
                </div>

                <button class="btn btn-primary-viator w-100 mt-3" id="checkAvailabilityBtn">
                    Check Availability
                </button>

                <div class="mt-3 p-3 rounded" style="background:#5f352a; border:1px solid #eec507;">
                    <p class="mb-1 info-line"><i class="fa fa-check-circle"></i> Free cancellation up to 24 hours before</p>

                    <p class="mb-0 info-line"><i class="fa fa-check-circle"></i> Reserve Now and Pay Later</p>
                    <button class="btn btn-outline-warning MyBtn" >
                        <a href="MyBooking.html"><i class="fa-solid fa-book"></i> MyBooking</a>
                    </button>
                    <button class="btn btn-outline-warning MyBtn">
                        <a href="MyReview.html"><i class="fa-solid fa-book"></i> MyReview</a>
                    </button>
                </div>

                <!-- Availability results -->
                <div class="mt-3" id="availabilityWrap" style="display:none;">
                    <h6 class="mb-2">Available Workshops</h6>
                    <div class="availability-list" id="availabilityList"></div>
                </div>

                <!--                <div class="mt-3 alert alert-warning mb-0">-->
                <!--                    <strong>Book ahead!</strong><br/>On average, this is booked 12 days in advance.-->
                <!--                </div>-->
            </div>
        </div>

    </div>
</div>

<div class="modal fade" id="imageModal" tabindex="-1" >
    <div class="modal-dialog modal-lg modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-body text-center">
                <img id="modalImage" src="" class="img-fluid rounded"></img>
            </div>

            <div class="modal-footer justify-content-between">
                <button type="button" class="btn btn-secondary" id="prevBtn">Prev</button>
                <button type="button" class="btn submit-btn" id="nextBtn">Next</button>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="participantModal" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content p-3">
            <h6 class="mb-2">Select up to <span id="maxTotalSpan"></span> participants in total.</h6>

            <div class="d-flex justify-content-between align-items-center my-2">
                <div>
                    <strong>Only over 8 years old</strong><br>
                    <small class="text-muted">Minimum: 0, Maximum: <span id="maxSpan"></span></small>
                </div>
                <div class="d-flex align-items-center">
                    <button class="btn btn-outline-secondary btn-sm" id="Minus"><i class="fa fa-minus"></i></button>
                    <span class="mx-3" id="participantCount">0</span>
                    <button class="btn btn-outline-secondary btn-sm" id="Plus"><i class="fa fa-plus"></i></button>
                </div>
                <div id="alert"></div>
            </div>

            <button class="btn btn-primary-viator w-100 mt-3" id="applyParticipants">Apply</button>
        </div>
    </div>
</div>

<!--//register and book modal-->

<div class="modal fade" id="WorkshopBookModal" tabindex="-1" aria-labelledby="editJobModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="WorkshopBookModalLabel">Edit Job</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <form id="WorkshopBookForm">
                <input type="hidden" id="editItemId" name="itemId">

                <h3 class="form-section-title">Workshop Booking</h3>
                <div class="row">
                    <div class="col-lg-12">
                        <div class="form-group">
                            <label>Enter the email of someone in your group</label>
                            <input class="form-control" type="email" name="email" id="email" required>
                        </div>
                    </div>
                    <div class="col-lg-12">
                        <div class="form-group">
                            <label>Enter The Phone Number of someone in your group.</label>
                            <input type="text" name="number" class="form-control" id="number" rows="5" required></input>
                        </div>
                    </div>

                    <div class="col-lg-12">
                        <div class="form-group">
                            <label>Your Country</label>
                            <input type="text" name="country" class="form-control" id="country" rows="5" required></input>
                        </div>
                    </div>

                    <div class="col-lg-12">
                        <div class="form-group">
                            <label>Total Fee</label><span class="text-danger font-weight-bold" id="totalFee">*</span>
                        </div>
                    </div>

                </div>
                <div class="modal-footer">
                    <button type="submit" class="btn btn-primary" id="book">Book Now</button>
                </div>


            </form>
        </div>
    </div>
</div>

<div class="modal fade" id="ReviewModal" tabindex="-1" aria-labelledby="editJobModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="ReviewModalLabel">Add Review</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>

            <form id="reviewForm" action="${pageContext.request.contextPath}/reviews" method="post" enctype="multipart/form-data">

                <input type="hidden" id="reviewId" name="reviewId">

                <div class="mb-3">
                    <label for="name" class="form-label">Visitor Name</label>
                    <input type="text" id="name" name="name" class="form-control" required>
                </div>


                <div class="mb-3">
                    <label class="form-label d-block">Rating</label>
                    <input type="hidden" id="rating" name="rating" value="0" required>
                    <div id="stars">
                        <span class="star" data-value="1">&#9733;</span>
                        <span class="star" data-value="2">&#9733;</span>
                        <span class="star" data-value="3">&#9733;</span>
                        <span class="star" data-value="4">&#9733;</span>
                        <span class="star" data-value="5">&#9733;</span>
                    </div>
                    <small id="ratingText" class="text-muted">No rating yet</small>
                </div>

                <div class="mb-3">
                    <label for="title" class="form-label">Title</label>
                    <input type="text" id="title" name="title" class="form-control" required>
                </div>

                <div class="mb-3">
                    <label for="description" class="form-label">Description</label>
                    <textarea id="description" name="description" class="form-control" rows="5" required></textarea>
                </div>

                <div class="mb-3">
                    <label for="wentDate" class="form-label">Date visited</label>
                    <input type="date" id="wentDate" name="wentDate" class="form-control">
                </div>



                <div class="d-flex gap-2">
                    <button type="submit" class="btn btn-primary">Submit Review</button>
                    <a href="${pageContext.request.contextPath}/workshops" class="btn btn-outline-secondary">Cancel</a>
                </div>
            </form>

        </div>
    </div>
</div>

<footer class="pt-5 pb-3" style="background-color: #4c2417; color: #f5f5f5;">
    <div class="container">
        <div class="row">

            <!-- Column 1: Brand / About -->
            <div class="col-md-4 mb-4">
                <h5 class="fw-bold text-warning">Heritage Portal</h5>
                <p class="small">
                    Discover and experience Sri Lankan traditional arts, crafts, foods, and culture.
                    Join us to explore workshops, guides, and authentic places across the island.
                </p>
            </div>

            <!-- Column 2: Quick Links -->
            <div class="col-md-4 mb-4">
                <h6 class="fw-bold text-warning">Quick Links</h6>
                <ul class="list-unstyled">
                    <li><a href="home.html" class="text-decoration-none text-light">üè† Home</a></li>
                    <li><a href="markscarving.html" class="text-decoration-none text-light">üé≠ Masks</a></li>
                    <li><a href="food.html" class="text-decoration-none text-light">üçõ Traditional Foods</a></li>
                    <li><a href="SignUp.html" class="text-decoration-none text-light">üìù Register</a></li>
                </ul>
            </div>

            <!-- Column 3: Contact / Social -->
            <div class="col-md-4 mb-4">
                <h6 class="fw-bold text-warning">Contact Us</h6>
                <p class="small mb-1">üìç Mathugama, Sri Lanka</p>
                <p class="small mb-1">üìû +94 77 9978 399</p>
                <p class="small">üìß sltraditionalexperience@gmail.com</p>

                <!-- Social Icons -->
                <div class="mt-3">
                    <a href="#" class="text-warning me-3 fs-5"><i class="bi bi-facebook"></i></a>
                    <a href="#" class="text-warning me-3 fs-5"><i class="bi bi-instagram"></i></a>
                    <a href="#" class="text-warning me-3 fs-5"><i class="bi bi-twitter"></i></a>
                    <a href="#" class="text-warning fs-5"><i class="bi bi-youtube"></i></a>
                </div>
            </div>
        </div>

        <hr style="border-color: rgba(255, 193, 7, 0.4);">

        <!-- Bottom copyright -->
        <div class="text-center small text-light">
            &copy; <span id="year"></span>2025 Heritage Portal ‚Ä¢ All Rights Reserved
        </div>
    </div>
</footer>


<script src="js/jquery-3.7.1.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script src="js/SignIn.js"></script>
<script src="js/Review.js"></script>

<script>
    let allImages = [];
    let currentIndex = 0;

    function openModal(index) {
        currentIndex = index;
        $('#modalImage').attr('src', 'http://localhost:8080/uploads/' + allImages[currentIndex]);
        $('#imageModal').modal('show');
    }
    $(document).ready(function () {
        let params = new URLSearchParams(window.location.search);
        let workshopId = params.get('id');

        if(!workshopId){
            $('body').html('<p class="text-danger text-center">Workshop Not Found</p>')
            return
        }
        let token = localStorage.getItem('authtoken');
        $.ajax({
            url: `http://localhost:8080/api/v1/workshop/getWorkshopById/${workshopId}` ,
            method: 'GET',
            headers: {
                "Authorization": "Bearer " + token
            },
            success: function (response) {
                let workshop = response.data;
                workshopFee = parseFloat(workshop.fee.toString().replace(/[^0-9.]/g, '')) || 0;

                $("#workshopName").text(workshop.title);

                $("#workshopDescription").text(workshop.description);
                $("#workshopDuration").text(workshop.duration);
                $("#workshopLanguage").text(workshop.language);
                $("#workshopParticipants").text(workshop.participantCount)
                $("#workshopFee").text(workshop.fee);
                $("#fees").text(workshop.fee);
                $("#workshopAddress").text(workshop.address);
                $("#workshopTimes").text(workshop.time.join(", "));
                $("#workshopIncludes").text(workshop.include.join(", "));

                if(workshop.image && workshop.image.length > 0){
                    allImages = workshop.image;
                    $('#mainImage img').attr('src',`http://localhost:8080/uploads/${allImages[0]}`);
                    $('#thumbGallery').empty();

                    allImages.slice(0,5).forEach((img, index) => {
                        let thumbHtml = `<div class="thumbLeft">
                                                <img src="http://localhost:8080/uploads/${img}" data-index="${index}" />
                                            </div>`
                        $('#thumbGallery').append(thumbHtml);
                    })

                    if(allImages.length > 5){
                        $('#thumbGallery .thumbLeft:last').append(
                            `<div class="see-moreBTN" id="seeMoreBtn">See More</div>`
                        );
                    }
                    $('#thumbGallery').on('click','img', function () {
                        let idx = $(this).data('index');
                        $('#mainImage img').attr('src', $(this).attr('src'));

                    })
                    $('#thumbGallery').on('click','#seeMoreBtn', function () {
                        openModal(0);

                    })
                    $('#prevBtn').on('click', function () {
                        currentIndex = (currentIndex - 1 + allImages.length) % allImages.length;
                        $("#modalImage").attr("src", "http://localhost:8080/uploads/" + allImages[currentIndex]);

                    })
                    $('#nextBtn').on('click', function () {
                        currentIndex = (currentIndex +1) % allImages.length;
                        $("#modalImage").attr("src", "http://localhost:8080/uploads/" + allImages[currentIndex]);

                    })

                }

            }



        })
        let maxParticipant = 0;
        let currentParticipant = 0;



        $('#participantCell').on('click', function () {
            let params = new URLSearchParams(window.location.search);
            let workshopId = params.get('id');
            let token = localStorage.getItem('authtoken');

            $.ajax({
                url: `http://localhost:8080/api/v1/workshop/getParticipantCount/${workshopId}`,
                method: 'GET',
                headers: {
                    Authorization: 'Bearer ' + token
                },
                success: function (response) {
                     maxParticipant = response.data || 0;
                     currentParticipant =  0;

                    $('#participantCount').html(maxParticipant);
                    $('#participantCountDisplay').text(maxParticipant);
                    $('#maxSpan').text(maxParticipant);
                    $('#maxTotalSpan').text(maxParticipant);
                    $('#participantModal').modal('show');


                },

                error: function (response) {
                    $('#participantCount').html(0);
                    $('#participantCountDisplay').text(0);
                }


            })
        });

        $('#Minus').on('click', function () {
            if(currentParticipant > 0 ){
                currentParticipant--;

                $('#participantCount').text(currentParticipant);
            }

        });
        $('#Plus').on('click', function () {
            if(currentParticipant < maxParticipant){
                currentParticipant++;
                $('#participantCount').text(currentParticipant);
            }else {
                alert("You can only select  " + maxParticipants + " participants.");

            }


        });
        $('#applyParticipants').on('click', function () {
            $('#participantCountDisplay').text(currentParticipant);
            $('#participantModal').modal('hide');
            if(currentParticipant === maxParticipant){
                alert("You cannot select more than " + maxParticipant + " participants.");

            }



        })

        $('#dateCell').on('click', function () {
            $('#bookingDate').removeClass('d-none')[0].click();
        });
        $('#bookingDate').on('change', function () {
            let selected = $(this).val();
            if(selected){
                $('#dateDisplay').text(selected);
                $('#bookingDate').addClass('d-none');
            }
        });

        $('#checkAvailabilityBtn').on('click', function (){
            let token = localStorage.getItem('authtoken');
            let params = new URLSearchParams(window.location.search);
            let workshopId = params.get('id');

            let selectedDate = $('#dateDisplay').text();
            let participantCount = $('#participantCountDisplay').text();

            if(!selectedDate){
                Swal.fire({icon:'warning', title:'Please select a date'});
                return;
            }
            if(!participantCount || participantCount === 0){
                Swal.fire({icon:'warning', title:'Please select a Date And Your Member Count'});
                return;
            }
            $.ajax({
                url:`http://localhost:8080/api/v1/workshopRegistration/checkAvailability/${workshopId}?date=${selectedDate}`,
                method:'GET',
                headers: {
                    "Authorization": "Bearer " + token
                },
                success: function (slots) {
                    $('#availabilityWrap').show();
                    $('#availabilityList').empty();

                    if(slots.length === 0){
                        $('#availabilityList').html('<div class="availability-empty">No Times Available for this day</div>')
                        return;
                    }
                    slots.forEach(function (slot) {
                        let isAvailable = slot.available;
                        let btn = `<button class=" btn btn-primary-viator w-100 mb-2 slotBtn"
                                       data-time="${slot.time}" ${isAvailable ? "" : "disabled"}>
                                       ${slot.time} ${isAvailable ? "" : "(Booked)"}
                                    </button>`
                        $('#availabilityList').append(btn);
                    })


                },
                error: function (response) {
                    Swal.fire({
                        icon:'error',
                        title:'Error Checking Available'
                    });
                    return;
                }
            })
        })

        let workshopFee = 0;
        let selectedSlot = null;

        $(document).on('click', '.slotBtn', function () {
            selectedSlot = $(this).data('time');

            let participants = parseInt($('#participantCountDisplay').text());
            let totalFee = workshopFee * participants;
            $('#totalFee').text('$' + totalFee.toFixed(2));
            $('#WorkshopBookModal').modal('show')
        })
        $('#WorkshopBookForm').on('submit', function(e) {
            e.preventDefault();

            let email = $('#email').val();
            let phone = $('#number').val();
            let country = $('#country').val();
            let participants = parseInt($('#participantCountDisplay').text());
            let totalFee = workshopFee * participants;
            let selectedDate = $('#dateDisplay').text();
            let token = localStorage.getItem('authtoken');
            let userId = localStorage.getItem('userId');

            if (!selectedSlot) {
                alert('Please select a time slot');
                return;
            }


            let workshopDate = new Date(selectedDate);
            let registrationData = {
                email: email,
                phone: phone,
                country: country,
                registrationDate: new Date(),
                selectWorkshopDate: workshopDate,
                workshopTime: selectedSlot,
                member: participants,
                totalFee: totalFee,
                userId: userId ?  parseInt(userId): null,
                workshopId: parseInt(workshopId)
            };



            $.ajax({
                url: 'http://localhost:8080/api/v1/workshopRegistration/registerWorkshop',
                method: 'POST',
                contentType: 'application/json',
                headers: {
                    "Authorization": "Bearer " + token
                },
                data: JSON.stringify(registrationData),
                success: function (response) {
                    if (response.code === 201) {
                        Swal.fire({
                            icon:'success',
                            title:'Booking Successfully',
                        });

                        window.location.href = `Payment.html?registrationId=${response.data.id}&userId=${userId}`;


                    } else {
                        Swal.fire({
                            icon:'error',
                            title:'Can not Booking',
                        });
                    }
                },
                error: function (err) {
                    Swal.fire({
                        icon:'error',
                        title:'Error while booking. Try again.',
                    });

                    console.error(err);
                }
            });
        })
        $('#reviewBtn').on('click', function(){
            let workshopId = new URLSearchParams(window.location.search).get('id');
            window.location.href = `review.html?id=${workshopId}`;
        });



    })

</script>
</body>
</html>

